<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=400">
  <title>AttentionGuard</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <img src="../assets/icons/brain-cog-red-32.png" alt="AttentionGuard">
        <span class="title">AttentionGuard</span>
      </div>
      <div class="header-actions">
        <button class="theme-toggle" id="themeToggle" title="Toggle theme">
          <!-- Sun icon (shown in dark mode) -->
          <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <!-- Moon icon (shown in light mode) -->
          <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- No Platform State -->
    <div class="no-platform" id="noPlatform">
      <div class="no-platform-icon">
        <img src="../assets/icons/brain-cog-48.png" alt="">
      </div>
      <h2>No supported platform</h2>
      <p>Visit Reddit, Twitter, Facebook, Instagram, LinkedIn, YouTube, or Amazon to see manipulation stats.</p>
      <div class="request-section" id="requestSection" style="display: none;">
        <p class="current-site">Current site: <strong id="currentSiteName">-</strong></p>
        <button class="request-btn" id="requestBtn">Request AttentionGuard for this site</button>
      </div>
    </div>

    <!-- Active Platform State -->
    <div class="active-platform" id="activePlatform" style="display: none;">
      <!-- Platform Header -->
      <div class="platform-header" id="platformHeader">
        <div class="platform-info">
          <span class="platform-icon" id="platformIcon"></span>
          <span class="platform-name" id="platformName">Platform</span>
        </div>
        <div class="header-right-info">
          <span class="total-badge" id="totalBadge">0 posts</span>
          <span class="session-time" id="sessionTime">0:00</span>
        </div>
      </div>

      <!-- Feed Composition Section -->
      <div class="feed-composition">
        <div class="composition-header">
          <h3>Feed Composition</h3>
        </div>

        <!-- Pie Chart + Legend -->
        <div class="composition-main">
          <!-- Pie Chart -->
          <div class="pie-chart-wrapper">
            <div class="pie-chart" id="pieChart">
              <div class="pie-center">
                <span class="pie-value" id="intentionalPercent">0%</span>
                <span class="pie-label">Intentional</span>
              </div>
            </div>
          </div>

          <!-- Legend with expandable Tier 2 -->
          <div class="composition-legend">
            <!-- Intentional -->
            <div class="legend-item" data-category="organic">
              <div class="legend-row">
                <span class="legend-color intentional"></span>
                <div class="legend-text">
                  <span class="legend-name">Intentional</span>
                  <span class="legend-desc">From accounts you follow</span>
                </div>
                <span class="legend-value" id="intentionalValue">0%</span>
                <span class="legend-expand" id="expandIntentional">▶</span>
              </div>
              <div class="legend-tier2 collapsed" id="tier2Intentional">
                <div class="tier2-count"><span id="organicCount">0</span> posts from your subscriptions and connections</div>
              </div>
            </div>

            <!-- Algorithmic -->
            <div class="legend-item" data-category="algorithmic">
              <div class="legend-row">
                <span class="legend-color algorithmic"></span>
                <div class="legend-text">
                  <span class="legend-name">Algorithmic</span>
                  <span class="legend-desc">Pushed by the platform's AI</span>
                </div>
                <span class="legend-value" id="algorithmicValue">0%</span>
                <span class="legend-expand" id="expandAlgorithmic">▶</span>
              </div>
              <div class="legend-tier2 collapsed" id="tier2Algorithmic">
                <div class="tier2-header">
                  <span id="algoCount">0</span> posts selected by algorithms
                </div>
                <div class="tier2-subtitle">Detected signals:</div>
                <div class="tier2-breakdown" id="algorithmicBreakdown">
                  <!-- Platform-specific breakdown inserted by JS -->
                </div>
              </div>
            </div>

            <!-- Echoed -->
            <div class="legend-item" data-category="social">
              <div class="legend-row">
                <span class="legend-color echoed"></span>
                <div class="legend-text">
                  <span class="legend-name">Echoed</span>
                  <span class="legend-desc">Shown because others engaged</span>
                </div>
                <span class="legend-value" id="echoedValue">0%</span>
                <span class="legend-expand" id="expandEchoed">▶</span>
              </div>
              <div class="legend-tier2 collapsed" id="tier2Echoed">
                <div class="tier2-header">
                  <span id="socialCount">0</span> posts via network activity
                </div>
                <div class="tier2-subtitle">Detected signals:</div>
                <div class="tier2-breakdown" id="echoedBreakdown">
                  <!-- Platform-specific breakdown inserted by JS -->
                </div>
              </div>
            </div>

            <!-- Sponsored -->
            <div class="legend-item" data-category="ads">
              <div class="legend-row">
                <span class="legend-color sponsored"></span>
                <div class="legend-text">
                  <span class="legend-name">Sponsored</span>
                  <span class="legend-desc">Paid advertisements</span>
                </div>
                <span class="legend-value" id="sponsoredValue">0%</span>
                <span class="legend-expand" id="expandSponsored">▶</span>
              </div>
              <div class="legend-tier2 collapsed" id="tier2Sponsored">
                <div class="tier2-header">
                  <span id="adsCount">0</span> paid placements
                </div>
                <div class="tier2-subtitle">Detected signals:</div>
                <div class="tier2-breakdown" id="sponsoredBreakdown">
                  <!-- Platform-specific breakdown inserted by JS -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Feed Health Bar -->
      <div class="feed-health">
        <div class="health-header">
          <span class="health-title">Feed Health</span>
          <span class="health-score" id="healthScore">0%</span>
        </div>
        <div class="health-bar">
          <div class="health-fill" id="healthFill"></div>
        </div>
        <p class="health-desc" id="healthDesc">Analyzing your feed...</p>
      </div>

      <!-- Hidden legacy elements for JS compatibility -->
      <span id="scoreNumber" style="display:none;">0</span>
      <span id="manipulatedCount" style="display:none;">0</span>
      <span id="totalCount" style="display:none;">0</span>
      <div id="progressFill" style="display:none;"></div>
      <circle id="scoreProgress" style="display:none;"></circle>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button class="reset-btn" id="resetBtn">Reset Session</button>
        <label class="persist-toggle">
          <input type="checkbox" id="persistToggle">
          <span>Keep data across restarts</span>
        </label>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="privacy-notice">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
        </svg>
        <span>100% local. No data ever leaves your browser.</span>
      </div>
      <div class="footer-links">
        <span>Powered by <a href="https://agentkite.com" target="_blank">AgentKite</a></span>
        <a href="https://github.com/agentkites/attentionguard-extension" target="_blank" class="github-link">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
          </svg>
        </a>
      </div>
    </footer>
  </div>

  <!-- Category Details Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-header">
        <h3>
          <span class="modal-icon" id="modalIcon"></span>
          <span id="modalTitle">Category</span>
        </h3>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- Content injected by JS -->
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
